name: Node.js CI

on:
 push:
  branches: [ main ]

jobs:
 build:

  runs-on: ubuntu-latest

  strategy:
    matrix:
      node-version: [16.x]

  steps:
  - uses: actions/checkout@v2
  - name: Use Node.js ${{ matrix.node-version }}
    uses: actions/setup-node@v2
    with:
      node-version: ${{ matrix.node-version }}
  - run: npm install
  - run: npm run build --if-present

 release:
  needs: build
  runs-on: ubuntu-latest

  steps:
  - uses: actions/checkout@v2
  - name: Create Release
    id: create_release
    uses: actions/create-release@v1
    env:
      GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
    with:
      tag_name: ${{ github.ref }}
      release_name: Release ${{ github.ref }}
      draft: false
      prerelease: false

  - name: Upload Release Asset
    id: upload-release-asset 
    uses: actions/upload-release-asset@v1
    env:
      GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
    with:
      upload_url: ${{ steps.create_release.outputs.upload_url }} 
      asset_path: ./dist/gfn.linux
      asset_name: gfn.linux
      asset_content_type: application/octet-stream